---
title: "dataset_intro"
author: "Sarah Deussing, Ryan Steffe, Taylor Hill"
date: "2024-09-27"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

##Loading Packages
```{r}
library(tidyr)
library(tidyverse)
library(dplyr)
library(caret)
library(ggplot2)
library(readr)
library(xgboost)
library(stringr)
library(lubridate)
```

## Read Dataset
```{r Read in data}
fraud <- read.csv("fraud_data.csv")
summary(fraud)
```


##Data Cleaning
There are two columns that contain dates to be converted (trans_date_trans_time and dob). We also want to make an 'age' column from the date of birth.
```{r}
# Make date column
fraud[c('trans_date', 'trans_time')] <- str_split_fixed(fraud$trans_date_trans_time, " ", 2)
fraud$trans_date <- as.Date(fraud$trans_date, "%d-%m-%Y")

# Make age column
fraud$dob <- as.Date(fraud$dob, "%d-%m-%Y")
fraud$age <- floor(interval(fraud$dob, now()) / years(1))
```

Clean the response variable
```{r}
unique(fraud$is_fraud)

# We see some entries that contain information beyond '1' or '0'.
fraud$is_fraud <- substring(fraud$is_fraud, 1, 1)

# We also want to convert this to numeric
fraud$is_fraud <- as.factor(fraud$is_fraud)
```


## Exploratory Plots
The response variable is 'is_fraud'. 1 denotes fraud, 0 denotes not fraud.

The five explanatory variables we are looking at are:
  - Category
  - Amount
  - Merchant
  - Time (Time of day or time of year)
  - Age

To do this, let's look at plots of each variable with our response (is_fraud).

```{r}
# 1. Category
ggplot(fraud, aes(x=category, group = is_fraud, fill = is_fraud)) + geom_bar() +
  theme(axis.text.x = element_text(angle = 90)) +
  labs(title = 'Count of Fraud in Transaction Categories', x = 'Category') 

# 2. Amount

# 3. Merchant

# 4. Time

# 5. Age
```


- make a plot of fraud by longitude/latitude coordinates (sender and merchant)
```{r}
library(sf)

points_md <- st_as_sf(fraud, coords = c('long', 'lat'))
points_md <- st_set_crs(points, crs = 'EPSG:4326 - WGS 84')

#Plot it:
ggplot(points_md) + 
  geom_sf(aes(color = is_fraud))
```


## Logistic Regression
Because we have a binary response variable, we can run logistic regression. We are going to do this in 2 ways. First, we will look at the variables we explored above; then, we will run a lasso model with all of our variables.

#### Split into training + test sets
- split data
- look at balance, balance if need to.

#### Run Logistic Regression Model
- look at variance, accuracy, etc.

#### Run Lasso Logistic Regression Model
- look at variance, accuracy, etc.

## Time Series Modeling
- amount over time
- fraud over time??
